{% extends 'base.html' %}
{% block content %}
{% include 'navbar.html' %}

<div class="cp">
  <h1>Add New Product Entry</h1>

  <form method="POST" enctype="multipart/form-data" onsubmit="return formatPriceBeforeSubmit()">
      {% csrf_token %}
      
      <div class="form-group">
          <label for="{{ form.name.id_for_label }}">{{ form.name.label }}</label>
          {{ form.name }}
          {% if form.name.errors %}
              <ul class="errorlist">
                  {% for error in form.name.errors %}
                      <li>{{ error }}</li>
                  {% endfor %}
              </ul>
          {% endif %}
      </div>

      <div class="form-group">
          <label for="{{ form.price.id_for_label }}">{{ form.price.label }}</label>
          <input type="text" name="price" id="{{ form.price.id_for_label }}" placeholder="Rp 0" required />
          {% if form.price.errors %}
              <ul class="errorlist">
                  {% for error in form.price.errors %}
                      <li>{{ error }}</li>
                  {% endfor %}
              </ul>
          {% endif %}
      </div>

      <div class="form-group">
          <label for="{{ form.description.id_for_label }}">{{ form.description.label }}</label>
          {{ form.description }}
          {% if form.description.errors %}
              <ul class="errorlist">
                  {% for error in form.description.errors %}
                      <li>{{ error }}</li>
                  {% endfor %}
              </ul>
          {% endif %}
      </div>

      <div class="form-group">
          <label for="{{ form.shade_name.id_for_label }}">{{ form.shade_name.label }}</label>
          {{ form.shade_name }}
          {% if form.shade_name.errors %}
              <ul class="errorlist">
                  {% for error in form.shade_name.errors %}
                      <li>{{ error }}</li>
                  {% endfor %}
              </ul>
          {% endif %}
      </div>

      <div class="form-group">
          <label for="{{ form.stock_quantity.id_for_label }}">{{ form.stock_quantity.label }}</label>
          {{ form.stock_quantity }}
          {% if form.stock_quantity.errors %}
              <ul class="errorlist">
                  {% for error in form.stock_quantity.errors %}
                      <li>{{ error }}</li>
                  {% endfor %}
              </ul>
          {% endif %}
      </div>

      <div class="form-group">
          <label for="image">Upload Image:</label>
          <input type="file" name="image" id="image" accept="image/*" required />
          <img id="image-preview" src="" alt="Image Preview" style="display:none; max-width: 200px; margin-top: 10px;"/> <!-- Preview gambar -->
          {% if form.image.errors %}
              <ul class="errorlist">
                  {% for error in form.image.errors %}
                      <li>{{ error }}</li>
                  {% endfor %}
              </ul>
          {% endif %}
      </div>

      <div class="form-group">
          <input type="submit" value="Add Product Entry" class="submit-btn" />
      </div>
  </form>
</div>

<script>
    // Script untuk preview gambar
    document.getElementById('image').addEventListener('change', function(event) {
        const imagePreview = document.getElementById('image-preview');
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                imagePreview.src = e.target.result;
                imagePreview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }
    });

    // Script untuk format harga di dalam input
    document.getElementById('{{ form.price.id_for_label }}').addEventListener('input', function(event) {
        let value = this.value.replace(/[^0-9]/g, ''); // Menghapus semua non-digit
        if (value) {
            value = parseInt(value).toLocaleString('id-ID'); // Format ke format rupiah
            this.value = 'Rp ' + value; // Menampilkan format harga dengan 'Rp'
        } else {
            this.value = 'Rp 0'; // Jika tidak ada input, set ke 'Rp 0'
        }
    });

    // Fungsi untuk format harga sebelum submit
    function formatPriceBeforeSubmit() {
        const priceInput = document.getElementById('{{ form.price.id_for_label }}');
        let value = priceInput.value.replace(/[^0-9]/g, ''); // Hanya ambil angka
        priceInput.value = value; // Set nilai input menjadi hanya angka
        return true; // Lanjutkan pengiriman form
    }
</script>

{% endblock content %}
